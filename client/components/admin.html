<head>
  <title>LE PONT</title>
  <meta charset="utf-8">
</head>

<template name="admin">

  <h1>Admin</h1>
  {{> loginButtons}}
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        
      </div>
    </div>

    <div class="row">
        <h2>Spectacle <button data-toggle="collapse" data-target="#showtime">▾</button></h2>

        <div id="showtime" class="collapse in">

          <div class="col-lg-12 col-md-12">
                {{> showtime}}
          </div>
        </div>
    </div>


    <div class="row">
        <h2>Téléphones <button data-toggle="collapse" data-target="#phones">▾</button></h2>

        <div id="phones" class="collapse">

          <div class="center-block col-md-10">
                {{> phonesList}}
          </div>
        </div>
    </div>


    <div class="row">
        <h2>Stats Server - Users online <button data-toggle="collapse" data-target="#stats">▾</button></h2>

        <div id="stats" class="collapse">

          <div class="col-lg-3 col-md-3">
                {{> status userStatus}}
          </div>
          <div class="col-lg-9 col-md-9">
              {{> serverStatus }}
          </div>
        </div>
    </div>
    


    <div class="row">
      {{> screen}}
    </div>
  </div>  


</template>


<template name="status">
    <h3>Local status:</h3>

    <button class="btn btn-success resync">Resync Time</button>

    <dl class="dl-horizontal">
        <dt>Server Time:</dt><dd>{{serverTime}}</dd>
        <dt>Local Offset:</dt><dd>{{serverOffset}} ms</dd>
        <dt>RTT:</dt><dd>{{serverRTT}} ms</dd>
        <dt>Idle:</dt><dd>{{isIdleText}}</dd>
        <dt>Monitor on:</dt><dd>{{isMonitoringText}}</dd>
        <dt>Last Activity:</dt><dd>{{lastActivity}}</dd>
    </dl>

    {{#if isMonitoring}}
    <h4>Idle monitoring is on.</h4>
    <button class="btn btn-danger stop-monitor">Stop Monitor</button>
    {{else}}
    <form class="start-monitor">
        <legend>Start monitor with the following parameters:</legend>
        <label>Idle Threshold:</label>
        <input class="form-control" name="threshold" type="number" min="5000" step="1" value="30000" required>
        <label>Monitor Interval:</label>
        <input class="form-control" name="interval" type="number" min="1000" step="1" value="1000" required>
        <label>Idle on window blur:</label>
        <select class="form-control" name="idleOnBlur" required>
            <option value="true" selected>true</option>
            <option value="false">false</option>
        </select>
        <button type="submit" class="btn btn-primary pull-right">Start Monitor</button>
    </form>
    {{/if}}
</template>

<template name="serverStatus">
    <h3>All user connections on server:</h3>
    <p>There are currently {{allUsersCount}} ({{anonymousCount}} anonymous) users online.</p>
    <table class="table table-condensed table-striped table-hover">
        <thead>
            <tr>
                <th>Username/Connection</th>
                <th>Route</th>
                <th>Idle</th>
                <th>Last Activity</th>
                <th>IP (<i>Last</i>)</th>
                <th style="width: 256px">User Agent (<i>Last</i>)</th>
            </tr>
        </thead>
        <tbody>
        {{#each anonymous}}
        {{> serverConnection}}
        {{/each}}
        {{#each users}}
            <tr class="bold {{userClass}}">
                <td>{{username}}<br>(last login {{localeTime status.lastLogin.date}})</td>
                <td>{{status.idle}}</td>
                <td>{{#with status.lastActivity}}
                    {{> relTime}}
                    {{else}}
                    (active or not monitoring)
                    {{/with}}
                </td>
                <td><i>{{status.lastLogin.ipAddr}}</i></td>
                <td><i>{{status.lastLogin.userAgent}}</i></td>
            </tr>
            {{#each connections}}
            {{> serverConnection}}
            {{/each}}
        {{/each}}
        </tbody>
    </table>
</template>

<template name="serverConnection">
    <tr class="{{connectionClass}}">
        <td>{{_id}}{{#with loginTime}}<br>(login {{this}}){{/with}}</td>
        <td>{{currentRoute}}</td>
        <td>{{idle}}</td>
        <td>{{#with lastActivity}}
            {{> relTime}}
            {{else}}
            (active or not monitoring)
            {{/with}}
        </td>
        <td>{{ipAddr}}</td>
        <td>{{userAgent}}</td>
    </tr>
</template>

<template name="relTime">
    {{localeTime this}}
    <br>
    ({{relativeTime this}})
</template>


<template name="showtime">
    showtime !<br />

    <div>
      yoyoyoy
      {{cuppasCount}}
      <input type="button" id="top_midi1" value="BUCHE 1">
      <input type="button" id="top_midi2" value="BUCHE 2">
      <input type="button" id="top_midi3" value="BUCHE 3">
      <input type="button" id="top_midi4" value="BUCHE 4">
      <input type="button" id="top_midi5" value="BUCHE 5">
      <input type="button" id="top_midi6" value="BUCHE 6">
      <input type="button" id="kill_midi" value="KILL MIDI">
      <input type="button" id="resetCuppas" value="reset cuppas">
    </div>

    <div class="switches small">
      <label for="josebove" title="ou prendre la main sur le déroulé des évènements">Prendre le pouvoir</label> 
      <input id="josebove" title="aka José Bové!" type="checkbox" checked="{{isPowerToTheAdminChecked}}" /><br />

      <label for="startSpectacle" title="ou démarrer le Spectacle">Démarrer/arrêter le spectacle</label> 
      <input id="startSpectacle" title="aka start the show!" type="checkbox" checked="{{isTheShowStarted}}" /><br />

      <!--<label for="SUPERinterrupt" title="ou mode parking pour les SALM pas jacky">SUPERinterrupt</label> 
      <input id="SUPERinterrupt" title="aka Parking SALM!" type="checkbox" checked="{{isSUPERinterruptChecked}}" /><br />-->

      <label for="showmode" title="ou mettre le site en mode Spectacle">Mode Spectacle</label>
      <input id="showmode" title="aka let's gro!" type="checkbox" checked="{{isModeSpectacleChecked}}" /><br />
      <br />
      SUPERinterrupt = <br />
      <button type="button" class="add-SUPERinterrupt" value="salm">parking ON salm</button>
      <button type="button" class="add-SUPERinterrupt" value="jacky_one">parking ON jacky_one</button>
      <button type="button" class="add-SUPERinterrupt" value="jacky_lt">parking ON jacky_lt</button><br />
      en cours de parking :<br />
      {{#each whoIsSUPERinterrupted}}
        {{this}} <button class="remove-SUPERinterrupt" type="submit" value="{{this}}">x</button>
      {{/each}}

      <input type="button" id="resetSUPERinterrupt" value="reset SUPERinterrupt" />
      <input type="text" id="whereSUPERinterrupt" placeholder="bookmark?" value="liaison_tel"/>
      <br />
      <br />
      <!--<h4 class="page-header">compteurs</h4>

        <table class="table table-bordered">
          <thead>
            <tr>
              <th class="text-center">Role</th>
              <th class="text-center">X</th>
            </tr>
          </thead>
          <tbody>
          {{#each compteurs}}
          <tr>
            <td>{{_id}}</td>
            <td>{{roles.[0]}}</td>
            <td>
              {{#if isCurrentUser _id}}
              no
              {{else}}
              {{> quickRemoveButton collection="superGlobals" _id=_id onError=quickRemoveButtonOnError onSuccess=quickRemoveButtonOnSuccess beforeRemove=quickRemoveButtonBeforeRemove class="btn btn-danger"}}
              {{/if}}
            </td>
          </tr>
          {{/each}}
          </tbody>
        </table>
        <form id="addcompteur">
          <table class="table table-bordered">
            <tbody>
            <tr>
              <td class="text-left text-middle"><input id="newCompteur" name="compteurName" placeholder="compteur pour role" /></td>
              <td>
                <button type="submit">Add</button>
              </td>
            </tr>
            </tbody>
          </table>
        </form>
      compteurs<br />
      {{#each dataArray compteurs}}
          {{this.key}}.
          {{#each dataArray this.value}}
            {{this.key}}: {{this.value}}<br />
          {{/each}}
          <br />
      {{/each}}
      -->
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
    </div>
    <button id="next">next</button>


    
    <button id="start-the-stream">start the stream</button>


    
    <button id="show-the-ONE">montrer les boutons à jacky</button>
    <button id="hide-the-ONE">cachez moi ces boutons que je ne saurais voir</button>
    <!--<div id="srt-the-one">
      bienvenue,
    </div>-->
</template>


<template name="phonesList">

    <p>There are currently {{phoneNumbersCount}} phone numbers.</p>
    <table class="table table-condensed table-striped table-hover">
        <thead>
            <tr>
                <th>Phone</th>
                <th><span class="small">Calls</span></th>
                <th><span class="small">Created</span></th>
                <th><span class="small">Modified</span></th>
                <th><span class="small">X</span></th>
            </tr>
        </thead>
        <tbody>
        {{#each listPhoneNumbers}}
            <tr>
                <td class="bold">{{number}}</td>
                <td class="bold">{{calls}}</td>
                <td class="small">{{created}}</td>
                <td class="small">{{updated}}</td>
                <td>{{> quickRemoveButton collection="PhoneNumbers" _id=this._id onError=quickRemoveButtonOnError onSuccess=quickRemoveButtonOnSuccess beforeRemove=quickRemoveButtonBeforeRemove class="btn btn-danger"}}</td>
            </tr>
        {{/each}}
        </tbody>
    </table>
</template>