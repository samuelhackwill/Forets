<head>
  <title>Le pont</title>
  <meta charset="utf-8">
</head>

<link rel="stylesheet" type="text/css" href="srt.css">

<body onload="zoupage()">
  <div id="container">
    <div id="srt">
      Bonjour
    </div>
    <div id="checklist">
     <!--   <li id="q1"></li> -->
   </div>
   <div id="sacbouttons">
   </div>
 </div>

 <script>

  var compteur = 0

  var balise
  var _balise

  var data = []

  function loadJSON(callback) {   

    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', '/libs/output.json', true); // Replace 'my_data' with the path to your file
    xobj.onreadystatechange = function () {
      if (xobj.readyState == 4 && xobj.status == "200") {
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
          }
        };
        xobj.send(null);  
      }

//usage:
function zoupage() {
 loadJSON(function(response) {
  // Parse JSON string into object
  var actual_JSON = JSON.parse(response);

  for(i=0; i<actual_JSON.length; i++){
    if(actual_JSON[i]["type"] == "text" ){
      data.push(actual_JSON[i]["text"])
    }
    if(actual_JSON[i]["type"] == "balise"){
      data.push(actual_JSON[i])
    }       

  }

});
}

function next(){
  console.log(compteur)
  var currentSub = data[compteur]
  document.getElementById("srt").innerHTML = currentSub

  balise = data[compteur]["balise"]

  if(_balise != balise){

// quand tu tombes sur une balise crac passe des arguments
// à action qui décide quoi faire du coup.

action(data[compteur]["balise"], data[compteur]["text"])

balise = _balise
compteur+=1
next()
}

}

function action(type, commande){

  switch(type){
    case "b":
    var buttonsname = commande.match(/[^\s\d]\w+/g)
    var howmuch = buttonsname.length

    for(i=0; i<howmuch; i++){
      var button = document.createElement("input");
      button.type = "button";
      button.id = buttonsname[i]
      button.value = buttonsname[i];
      button.onclick = clicboutton;
      container.appendChild(button);
    }



    break;

    case "e":
    console.log("case "+ type)
  }

  function clicboutton(){
    console.log(this.id)
  }


}

document.onkeydown = function(e) {

  e = e || window.event


  //  KEYCODE 32 IS SPACEBAR
  // KEYCIODE 78 IS "n"

  if(e.keyCode =='32' && compteur <= data.length){
    compteur +=1
    next();
  }

}

</script>

</body>

